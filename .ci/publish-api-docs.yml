steps:
  - script: |
      git clone git@github.com:yawaramin/re-web.git .
      git checkout gh-pages
      git pull
    workingDirectory: $(Build.StagingDirectory)
    displayName: "Clone GitHub pages repo"
    inputs:
      azureSubscription: 'github.com_yawaramin'

  - script: |
      rm -rf $(Build.StagingDirectory)/ReWeb || true
      rm $(Build.StagingDirectory)/index.html || true
      rm $(Build.StagingDirectory)/odoc.css || true
      rm $(Build.StagingDirectory)/highlight.pack.js || true
    displayName: Remove last version of the docs

  - task: DownloadPipelineArtifact@2
    displayName: Download docs
    inputs:
      artifactName: Docs
      targetPath: $(Build.StagingDirectory)
    
  - script: |
      git config user.name "ReWeb Docs Bot"
      git add --all
      git commit --amend --message "Generate docs"
      git push --force origin gh-pages
    workingDirectory: $(Build.StagingDirectory)
    displayName: "Push docs to Github pages"
    inputs:
      azureSubscription: 'github.com_yawaramin'

